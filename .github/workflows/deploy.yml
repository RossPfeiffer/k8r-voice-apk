name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main
      - master
    paths:
      - 'docs/**'
      - 'app/build/outputs/apk/debug/app-debug.apk'
      - 'app-debug.apk'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Prepare APK for deployment
        run: |
          mkdir -p docs
          
          # Find APK file
          if [ -f "app/build/outputs/apk/debug/app-debug.apk" ]; then
            cp app/build/outputs/apk/debug/app-debug.apk docs/app-debug.apk
          elif [ -f "app-debug.apk" ]; then
            cp app-debug.apk docs/app-debug.apk
          else
            echo "‚ö†Ô∏è APK file not found. Please build the project first."
            exit 1
          fi
          
          # Get file size
          APK_SIZE=$(du -h docs/app-debug.apk | cut -f1)
          
          # Create HTML page
          cat > docs/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>K8R Voice APK Download</title>
              <style>
                  body {
                      font-family: 'Courier New', monospace;
                      background-color: #000000;
                      color: #00FF00;
                      margin: 0;
                      padding: 20px;
                      display: flex;
                      flex-direction: column;
                      align-items: center;
                      justify-content: center;
                      min-height: 100vh;
                  }
                  .container {
                      max-width: 600px;
                      width: 100%;
                      background-color: #0f111c;
                      padding: 30px;
                      border-radius: 8px;
                      border: 2px solid #00FF00;
                      text-align: center;
                  }
                  h1 {
                      color: #00FF00;
                      margin-bottom: 10px;
                  }
                  .version {
                      color: #888;
                      margin-bottom: 30px;
                      font-size: 14px;
                  }
                  .download-btn {
                      display: inline-block;
                      background-color: #00FF00;
                      color: #000000;
                      padding: 20px 40px;
                      text-decoration: none;
                      border-radius: 5px;
                      font-weight: bold;
                      font-size: 18px;
                      margin: 20px 0;
                      transition: background-color 0.3s;
                  }
                  .download-btn:hover {
                      background-color: #00CC00;
                  }
                  .feature {
                      background-color: #1a1a1a;
                      padding: 15px;
                      margin: 10px 0;
                      border-radius: 5px;
                      border-left: 4px solid #00FF00;
                      text-align: left;
                  }
                  .feature h3 {
                      color: #00FF00;
                      margin-top: 0;
                  }
                  .update-note {
                      background-color: #1a1a1a;
                      padding: 15px;
                      margin: 20px 0;
                      border-radius: 5px;
                      border: 2px solid #FF8800;
                      text-align: left;
                  }
                  .update-note h3 {
                      color: #FF8800;
                      margin-top: 0;
                  }
                  .instructions {
                      background-color: #1a1a1a;
                      padding: 20px;
                      border-radius: 5px;
                      margin: 20px 0;
                      text-align: left;
                  }
                  .instructions h3 {
                      color: #00FF00;
                      margin-top: 0;
                  }
                  .instructions ol {
                      color: #888;
                  }
                  .file-size {
                      color: #888;
                      font-size: 12px;
                      margin-top: 10px;
                  }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>üé§ K8R Voice APK</h1>
                  <div class="version">Version 2.14 (Build 17)</div>
                  
                  <div class="update-note">
                      <h3>üÜï Latest Update:</h3>
                      <p><strong>Simplified WebView Posting</strong></p>
                      <ul style="color: #888; text-align: left;">
                          <li>Streamlined form submission code</li>
                          <li>Better error handling and timeout management</li>
                          <li>Multiple submission methods (form.submit() + Enter key)</li>
                          <li>Improved reliability for posting to k8r.sh</li>
                      </ul>
                  </div>
                  
                  <a href="app-debug.apk" class="download-btn" download>üì• Download APK</a>
                  <div class="file-size">File size: $APK_SIZE</div>
                  
                  <div class="feature">
                      <h3>üé§ Voice-to-Text</h3>
                      <p>Speak into your phone and have your messages automatically posted to k8r.sh</p>
                  </div>
                  
                  <div class="feature">
                      <h3>üåê WebView Integration</h3>
                      <p>Uses Android WebView with JavaScript injection for reliable form posting</p>
                  </div>
                  
                  <div class="feature">
                      <h3>üìù Keyword Management</h3>
                      <p>Customizable keywords and code word replacement system</p>
                  </div>
                  
                  <div class="instructions">
                      <h3>üìã Installation:</h3>
                      <ol>
                          <li>Download the APK to your Android device</li>
                          <li>Enable "Install from Unknown Sources" in Settings</li>
                          <li>Open the downloaded APK file</li>
                          <li>Grant microphone and internet permissions</li>
                          <li>Start using voice commands!</li>
                      </ol>
                  </div>
                  
                  <p style="color: #888; font-size: 12px; margin-top: 30px;">
                      Built: $(date)<br>
                      Deployed via GitHub Pages
                  </p>
              </div>
          </body>
          </html>
          EOF
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs

